# .github/workflows/ci-cd.yml

name: Basic ML CI-CD

# 1. 트리거 설정: main 브랜치에 코드가 push 될 때마다 이 워크플로우를 실행
on:
  push:
    branches: [ main ]

jobs:
  # 2. 실행할 작업 정의 (하나의 작업 "build"를 정의)
  build:
    runs-on: ubuntu-latest # 이 작업을 실행할 가상 머신 환경

    steps: # 3. 작업 내에서 순서대로 실행될 단계들
    - name: Checkout repository
      # GitHub Actions에서 제공하는 기본 액션, 코드를 가상 머신으로 가져옴
      uses: actions/checkout@v3

    - name: Set up Python
      # 파이썬 환경 설정 액션
      uses: actions/setup-python@v4
      with:
        python-version: '3.9' # 사용할 파이썬 버전 지정

    - name: Install dependencies
      # pip을 사용해 requirements.txt에 명시된 라이브러리 설치
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run tests with pytest
      # CI의 핵심: pytest를 실행하여 코드의 안정성 검증
      run: |
        pytest tests/

    - name: Train model
      # CD의 핵심: 테스트가 통과하면, 모델 학습 스크립트 실행
      run: |
        python src/train.py

    - name: Upload model artifact
      # 학습 결과물(모델 파일)을 GitHub Actions에 업로드하여 다운로드할 수 있게 함
      uses: actions/upload-artifact@v4
      with:
        name: trained-model
        path: model.joblib # 업로드할 파일 경로
